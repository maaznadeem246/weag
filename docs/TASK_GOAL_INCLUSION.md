# Task Goal Inclusion in Assessment Messages

## Overview

Green Agent now includes the **task goal** from BrowserGym's environment observation in the assessment message sent to Purple Agent. This provides explicit task instructions rather than requiring the agent to discover the goal only through observations.

## Source of Task Goal

The task goal comes directly from **BrowserGym SDK** via the observation dictionary:

```python
# When environment is created/reset
observation, info = env.reset()

# observation dict contains:
{
    "goal": "Click the button with text 'Submit'",  # ← Task-specific instruction
    "axtree_object": {...},
    "url": "http://localhost:...",
    ...
}
```

## Updated Task Message Format

### Before (No Goal)
```
============================================================
ASSESSMENT TASK
============================================================

## TASK DETAILS

- **Task ID**: `miniwob.ascending-numbers`
- **Benchmark**: miniwob

## OBJECTIVE

Complete the browser-based task by interacting with web elements. 
The environment has been initialized. Get the observation to understand 
the goal and execute actions to achieve it.
```

### After (With Goal from BrowserGym)
```
============================================================
ASSESSMENT TASK
============================================================

## TASK DETAILS

- **Task ID**: `miniwob.ascending-numbers`
- **Benchmark**: miniwob

## TASK GOAL (from BrowserGym)

Click on the numbers in ascending order starting from 1.

## INSTRUCTIONS

Complete the browser-based task by interacting with web elements. 
The environment has been initialized. Use `get_observation` to see the 
current page state and task goal, then execute actions to achieve it.
```

## Implementation Details

### Code Flow

1. **Environment Initialization** (SessionManager)
   ```python
   env = gym.make("browsergym/miniwob.ascending-numbers")
   observation, info = env.reset()
   session.update_observation(observation)  # Stores goal
   ```

2. **Goal Extraction** (communication_tools.py)
   ```python
   # Get task goal from session's current observation
   task_goal = None
   if session and session.current_observation:
       task_goal = session.current_observation.get("goal", "")
   ```

3. **Message Building** (_build_task_message)
   ```python
   # Build task goal section if available
   if task_goal:
       task_goal_section = f'''
## TASK GOAL (from BrowserGym)

{task_goal}
'''
   ```

4. **Purple Agent Receives Complete Task Info**
   - Task ID and benchmark
   - **Explicit task goal/instruction** ← NEW!
   - MCP connection details
   - Available tools documentation

## Benefits

1. **Clarity**: Purple Agent knows exactly what to accomplish upfront
2. **Efficiency**: Reduces need for trial-and-error exploration
3. **Authenticity**: Goal comes from BrowserGym SDK, not generated by LLM
4. **Redundancy**: Goal is available in both:
   - Initial task message (for planning)
   - Observation responses (for verification)

## Example Goals by Benchmark

### MiniWoB++
- `"Click the button with text 'Submit'"`
- `"Click on the numbers in ascending order starting from 1"`
- `"Enter 'test@example.com' in the email field and click Submit"`

### WebArena
- `"Navigate to the product page for 'Wireless Mouse' and add it to cart"`
- `"Find the contact information for the customer service department"`

### VisualWebArena
- `"Click on the icon that looks like a settings gear"`
- `"Find and click the search button (magnifying glass icon)"`

## Notes

- The goal field is **part of BrowserGym's standard observation format**
- It's generated by the benchmark's task definition, not by an LLM
- If the goal is not available (empty string), the message section is omitted
- Purple Agent can still call `get_observation` to retrieve the goal at any time

## Verification

You can verify the goal is from BrowserGym by:

1. Checking the logs:
   ```
   [INFO] Retrieved task goal from observation: Click the button...
   ```

2. Inspecting the observation dict:
   ```python
   observation = session.current_observation
   print(observation["goal"])  # Direct from BrowserGym
   ```

3. Confirming it matches the task's expected behavior when reward=1.0
